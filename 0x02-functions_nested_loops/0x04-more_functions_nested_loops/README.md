More c funtions and more nested loops
